<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link href="./css/main.css" rel="stylesheet" />

        <!-- tailwind core (need to remove after build is fixed) -->
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- apline core -->
        <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

        <!-- alpine plugins -->
        <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/mask@3.x.x/dist/cdn.min.js"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/focus@3.x.x/dist/cdn.min.js"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>

        <!-- exo 2 font -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

        <!-- fustat font -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Fustat:wght@200..800&display=swap" rel="stylesheet">

        <!-- kdam thmor pro font -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Kdam+Thmor+Pro&display=swap" rel="stylesheet">

        <!-- jersey 25 font -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Jersey+25&display=swap" rel="stylesheet">
	</head>

	<body class="bg-[--light2] px-4 py-8">
        <div x-data="getBlogEntries()">
            <div class="relative w-full max-w-64 flex flex-col py-2 border-2 fustat border-[--light2] bg-[--light1] rounded-full">
                <input 
                    type="text" 
                    name="query" 
                    @focus="show = true"
                    @blur="hideResults()"
                    x-ref="searchInput" 
                    x-model="search" 
                    x-on:keydown.window.prevent.slash="$refs.searchInput.focus()"
                    placeholder="search" 
                    class="placeholder-[--green2] ml-5 focus:outline-none"
                />
            </div>
            
            <div x-show="show" @mousedown.prevent>
                <template x-for="blog in filteredBlogEntries" :key="blog.date">
                    <div 
                        x-transition
                        class="bg-[--light1] p-2 max-w-64 rounded-md my-1 hover:bg-[--light2]"
                    >
                        <a :href="blog.link" @mousedown.prevent>
                            <p class="exo text-base text-[--dark1]" x-text="blog.date"></p>
                            <p class="fustat text-sm text-[--dark2]" x-text="blog.preview"></p>
                        </a>
                    </div>
                </template>
            </div>
        </div>

		<script>
			function getBlogEntries() {
				return {
					search: '',
                    show: false,

                    hideResults() {
                        setTimeout(() => { this.show = false }, 200);
                    },

					allData: [], 
                    loading: true, 
                    
                    init() {
                        fetch('blogData.json')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('the network response was not ok.');
                                }
                                return response.json();
                            })
                            .then(data => {
                                this.allData = data;
                            });
                    },

					get filteredBlogEntries() {
						if (this.search === '') {
							return [];
						}
						return this.allData.filter((blogEntry) => {
							return (blogEntry.date
								.replace(/ /g, '')
								.toLowerCase()
								.includes(this.search.replace(/ /g, '').toLowerCase())) ||
                                (blogEntry.preview
								.replace(/ /g, '')
								.toLowerCase()
								.includes(this.search.replace(/ /g, '').toLowerCase())) ||
                                (blogEntry.tags.some(tag => tag
								.replace(/ /g, '')
								.toLowerCase()
								.includes(this.search.replace(/ /g, '').toLowerCase())));
						});
					}
				};
			}
		</script>
	</body>
</html>